<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>千葉県かいごの職場見学BOX</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* お知らせのスクロールバーカスタマイズ */
        .news-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .news-scroll::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        .news-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .news-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen relative">

    <!-- ヘッダー -->
    <header class="bg-white shadow-sm sticky top-0 z-20">
        <div class="max-w-md mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2 cursor-pointer" onclick="showHome()">
                <div class="bg-orange-400 text-white p-1.5 rounded-lg">
                    <i data-lucide="coffee" class="w-5 h-5"></i>
                </div>
                <h1 class="text-lg font-bold text-slate-800 tracking-tight">千葉県かいごの職場見学BOX</h1>
            </div>
            
            <!-- ログインボタンエリア -->
            <div id="auth-btn-area">
                <button onclick="openAuthModal()" class="text-slate-300 hover:text-orange-500 p-2">
                    <i data-lucide="lock" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </header>

    <main id="main-content" class="max-w-md mx-auto px-4 py-6 space-y-8 min-h-[calc(100vh-140px)]">
        <!-- コンテンツがJavaScriptで描画されます -->
    </main>

    <!-- フッター -->
    <footer class="bg-slate-800 text-slate-300 py-8 text-center text-sm">
        <div class="max-w-md mx-auto px-4 space-y-4">
            <div class="flex items-center justify-center gap-2 text-white font-bold">
                <i data-lucide="coffee" class="text-orange-400 w-4 h-4"></i> 千葉県かいごの職場見学BOX
            </div>
            <p class="text-xs text-slate-500">© 2024 Kaigo Kengaku Box.</p>
        </div>
    </footer>

    <!-- パスワード認証モーダル -->
    <div id="auth-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-xs p-6 relative">
            <button onclick="closeAuthModal()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
            <div class="text-center mb-6">
                <div class="bg-slate-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3 text-slate-500">
                    <i data-lucide="lock" class="w-6 h-6"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800">事業所ログイン</h3>
                <p class="text-xs text-slate-500 mt-1">見学希望者リストの閲覧には<br/>パスワードが必要です。</p>
            </div>
            <input type="password" id="password-input" placeholder="パスワードを入力" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-4 py-3 mb-4 focus:outline-none focus:border-orange-500">
            <button onclick="handleAuth()" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 rounded-lg shadow transition-colors">認証する</button>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        const PASSWORD = 'chiba-kaigo';

        // エリア定義
        const areas = [
            { id: 'togane', name: '東葛北部・東葛南部圏域', code: '東葛北部・東葛南部圏域', cities: '(松戸市、野田市、柏市、流山市、我孫子市、鎌ケ谷市、市川市、船橋市、習志野市、八千代市、浦安市)' },
            { id: 'chiba-ichihara', name: '千葉・市原圏域', code: '千葉・市原圏域', cities: '(千葉市、市原市)' },
            { id: 'inba', name: '印旛・香取・海匝圏域', code: '印旛・香取・海匝圏域', cities: '(成田市、佐倉市、四街道市、八街市、印西市、白井市、富里市、酒々井町、栄町、香取市、神崎町、多古町、東庄町、銚子市、旭市、匝瑳市)' },
            { id: 'kimitsu', name: '君津・安房圏域', code: '君津・安房圏域', cities: '(木更津市、君津市、富津市、袖ケ浦市、館山市、鴨川市、南房総市、鋸南町)' },
            { id: 'sanbu', name: '山武・長生・夷隅圏域', code: '山武・長生・夷隅圏域', cities: '(東金市、山武市、大網白里市、九十九里町、芝山町、横芝光町、茂原市、一宮町、睦沢町、長生村、白子町、長柄町、長南町、勝浦市、いすみ市、大多喜町、御宿町)' }
        ];

        // 状態管理
        let currentView = 'home';
        let selectedAreaId = null;
        let isAuthenticated = false;
        let expandedFacilityIds = new Set();
        
        // テストデータ（最新のExcelから取得）
        let facilitiesData = [{"ID":"F001","事業所の名称":"特別養護老人ホーム 幕張の郷","エリア":"千葉・市原圏域","見学を受入できる対象者（複数回答可）":"将来介護職を探すかもしれない, 介護職にしようか迷っている","歓迎チェック （複数回答可）":"無資格OK, 未経験OK, 中高年歓迎","介護の仕事経験":"未経験OK","中高年世代の採用":"中高年歓迎","雇用形態":"アルバイト, 正社員","募集の日数（週） （複数回答可）":"週2～3日程度","募集の時間数（日） （複数回答可）":"4H","募集の時間（〇時～〇時）":"9:00～16:00（相談可）","担当者名":"見学担当","電話番号":"043-000-0001","連絡先メール":"sample1@example.com","HP":"https://example.com/makuhari","地図で見る":"千葉県千葉市花見川区幕張町1-1","種別 （複数回答可）":"特別養護老人ホーム","事業所からの一言":"アットホームな雰囲気で、未経験の方でも安心してスタートできます。まずは見学にお越しください。"},{"ID":"F002","事業所の名称":"グループホーム 船橋の陽だまり","エリア":"東葛北部・東葛南部圏域","見学を受入できる対象者（複数回答可）":"介護職を探している","歓迎チェック （複数回答可）":"有資格者のみ, 経験者のみ","介護の仕事経験":"経験者のみ","中高年世代の採用":"そのほか","雇用形態":"正社員","募集の日数（週） （複数回答可）":"週5日","募集の時間数（日） （複数回答可）":"相談可","募集の時間（〇時～〇時）":"8:30～17:30","担当者名":"佐藤","電話番号":"047-000-0002","連絡先メール":"sample2@example.com","HP":"https://example.com/funabashi","地図で見る":"千葉県船橋市本町2-2","種別 （複数回答可）":"グループホーム","事業所からの一言":"30分くらいで館内と仕事内容を説明します。"},{"ID":"F003","事業所の名称":"デイサービス 柏・元気クラブ","エリア":"東葛北部・東葛南部圏域","見学を受入できる対象者（複数回答可）":"6ヶ月以内に介護職を探すかもしれない","歓迎チェック （複数回答可）":"未経験OK, アルバイトから正社員","介護の仕事経験":"未経験OK","中高年世代の採用":"中高年歓迎","雇用形態":"アルバイト, アルバイトから正社員","募集の日数（週） （複数回答可）":"2,3日","募集の時間数（日） （複数回答可）":"相談可","募集の時間（〇時～〇時）":"10:00～15:00","担当者名":"見学担当","電話番号":"04-7100-0003","連絡先メール":"sample3@example.com","HP":"https://example.com/kashiwa","地図で見る":"千葉県柏市柏3-3","種別 （複数回答可）":"デイサービス","事業所からの一言":"70代のスタッフも活躍しています。"},{"ID":"F004","事業所の名称":"ケアハウス 成田の風","エリア":"印旛・香取・海匝圏域","見学を受入できる対象者（複数回答可）":"介護職にしようか迷っている, 3ヶ月以内に介護職を探すかもしれない","歓迎チェック （複数回答可）":"無資格OK, 中高年歓迎","介護の仕事経験":"未経験OK","中高年世代の採用":"中高年歓迎","雇用形態":"アルバイト","募集の日数（週） （複数回答可）":"相談可","募集の時間数（日） （複数回答可）":"2H","募集の時間（〇時～〇時）":"13:00～15:00","担当者名":"髙橋","電話番号":"0476-00-0004","連絡先メール":"sample4@example.com","HP":"なし","地図で見る":"千葉県成田市花崎町4-4","種別 （複数回答可）":"軽費老人ホーム","事業所からの一言":"無資格・未経験からのスタートも歓迎です。"},{"ID":"F005","事業所の名称":"訪問介護 木更津ステーション","エリア":"君津・安房圏域","見学を受入できる対象者（複数回答可）":"介護職を探している","歓迎チェック （複数回答可）":"有資格者のみ","介護の仕事経験":"経験者のみ","中高年世代の採用":"そのほか","雇用形態":"正社員","募集の日数（週） （複数回答可）":"週5日","募集の時間数（日） （複数回答可）":"6H以上","募集の時間（〇時～〇時）":"9:00～18:00","担当者名":"採用担当","電話番号":"0438-00-0005","連絡先メール":"sample5@example.com","HP":"https://example.com/kisarazu","地図で見る":"千葉県木更津市朝日5-5","種別 （複数回答可）":"訪問介護","事業所からの一言":"技術は、ことらで教えます。安心してください。"},{"ID":"F006","事業所の名称":"小規模多機能ホーム 茂原の里","エリア":"山武・長生・夷隅圏域","見学を受入できる対象者（複数回答可）":"将来介護職を探すかもしれない","歓迎チェック （複数回答可）":"未経験OK, 無資格OK","介護の仕事経験":"未経験OK","中高年世代の採用":"中高年歓迎","雇用形態":"アルバイト, 正社員","募集の日数（週） （複数回答可）":"週2日～","募集の時間数（日） （複数回答可）":"相談可","募集の時間（〇時～〇時）":"シフト制（応相談）","担当者名":"採用担当","電話番号":"0475-00-0006","連絡先メール":"sample6@example.com","HP":"なし","地図で見る":"千葉県茂原市道表6-6","種別 （複数回答可）":"小規模多機能","事業所からの一言":"見学は、スタッフが丁寧にご説明します。"},{"ID":"F007","事業所の名称":"有料老人ホーム 市川ガーデン","エリア":"東葛北部・東葛南部圏域","見学を受入できる対象者（複数回答可）":"介護職にしようか迷っている","歓迎チェック （複数回答可）":"無資格OK","介護の仕事経験":"未経験OK","中高年世代の採用":"そのほか","雇用形態":"正社員","募集の日数（週） （複数回答可）":"週5日","募集の時間数（日） （複数回答可）":"6H以上","募集の時間（〇時～〇時）":"9:00～18:00","担当者名":"山本","電話番号":"047-000-0007","連絡先メール":"sample7@example.com","HP":"https://example.com/ichikawa","地図で見る":"千葉県市川市八幡7-7","種別 （複数回答可）":"介護付き有料","事業所からの一言":"入門的研修の卒業も在籍中"},{"ID":"F008","事業所の名称":"サ高住 銚子シーサイド","エリア":"印旛・香取・海匝圏域","見学を受入できる対象者（複数回答可）":"将来介護職を探すかもしれない, 介護職にしようか迷っている","歓迎チェック （複数回答可）":"未経験OK, 中高年歓迎","介護の仕事経験":"未経験OK","中高年世代の採用":"中高年歓迎","雇用形態":"アルバイト","募集の日数（週） （複数回答可）":"相談可","募集の時間数（日） （複数回答可）":"相談可","募集の時間（〇時～〇時）":"9:00～12:00","担当者名":"中村","電話番号":"0479-00-0008","連絡先メール":"sample8@example.com","HP":"https://example.com/choshi","地図で見る":"千葉県銚子市三崎町8-8","種別 （複数回答可）":"サービス付き高齢者向け住宅","事業所からの一言":"いつでも受入OKです！"},{"ID":"F009","事業所の名称":"デイサービス 館山オーシャン","エリア":"君津・安房圏域","見学を受入できる対象者（複数回答可）":"介護職を探している","歓迎チェック （複数回答可）":"有資格者のみ","介護の仕事経験":"経験者のみ","中高年世代の採用":"中高年歓迎","雇用形態":"アルバイトから正社員","募集の日数（週） （複数回答可）":"3，4日","募集の時間数（日） （複数回答可）":"5H","募集の時間（〇時～〇時）":"10:00～16:00","担当者名":"小林","電話番号":"0470-00-0009","連絡先メール":"sample9@example.com","HP":"なし","地図で見る":"千葉県館山市北条9-9","種別 （複数回答可）":"デイサービス","事業所からの一言":"土日でもOK"},{"ID":"F010","事業所の名称":"特別養護老人ホーム 東金メドウ","エリア":"山武・長生・夷隅圏域","見学を受入できる対象者（複数回答可）":"3ヶ月以内に介護職を探すかもしれない","歓迎チェック （複数回答可）":"無資格OK, 未経験OK, アルバイト","介護の仕事経験":"未経験OK","中高年世代の採用":"そのほか","雇用形態":"アルバイト","募集の日数（週） （複数回答可）":"週3日程度","募集の時間数（日） （複数回答可）":"4H","募集の時間（〇時～〇時）":"13:00～17:00","担当者名":"加藤","電話番号":"0475-00-0010","連絡先メール":"sample10@example.com","HP":"https://example.com/togane","地図で見る":"千葉県東金市東金10-10","種別 （複数回答可）":"特別養護老人ホーム","事業所からの一言":"特養とデイの見学ができますよ。"}];
        
        let seekersData = [{"ID":"S001","仕事への興味":"将来介護職を探すかもしれない","お住まい":"千葉市稲毛区","性別":"男性","年齢":"20代","資格":"無資格","もし働くなら、どんな働き方？":"アルバイト","週に何日くらい？（アルバイト希望の方）":"2","1日何時間くらい？（アルバイト希望の方）":"3H","何時から何時くらい？":"午前中希望","聞きたいこと・不安なこと":"未経験でも大丈夫でしょうか？見学で雰囲気を見たいです。"},{"ID":"S002","仕事への興味":"介護職を探している","お住まい":"船橋市","性別":"女性","年齢":"40代","資格":"初任者研修","もし働くなら、どんな働き方？":"パート, 正社員","週に何日くらい？（アルバイト希望の方）":"4","1日何時間くらい？（アルバイト希望の方）":"5H","何時から何時くらい？":"10:00-15:00","聞きたいこと・不安なこと":"資格は持っていますがブランクがあります。研修制度について知りたいです。"},{"ID":"S003","仕事への興味":"介護職にしようか迷っている","お住まい":"木更津市","性別":"男性","年齢":"60代","資格":"その他","もし働くなら、どんな働き方？":"アルバイト","週に何日くらい？（アルバイト希望の方）":"3","1日何時間くらい？（アルバイト希望の方）":"4H","何時から何時くらい？":"午後のみ","聞きたいこと・不安なこと":"定年退職後の仕事として興味があります。体力面が少し不安です。"},{"ID":"S004","仕事への興味":"6ヶ月以内に介護職を探すかもしれない","お住まい":"成田市","性別":"女性","年齢":"30代","資格":"初任者研修受講中","もし働くなら、どんな働き方？":"正社員","週に何日くらい？（アルバイト希望の方）":"5","1日何時間くらい？（アルバイト希望の方）":"6H以上","何時から何時くらい？":"フルタイム","聞きたいこと・不安なこと":"現在資格取得中です。資格取得支援制度があるか聞きたいです。"},{"ID":"S005","仕事への興味":"3ヶ月以内に介護職を探すかもしれない","お住まい":"茂原市","性別":"男性","年齢":"20代","資格":"無資格","もし働くなら、どんな働き方？":"アルバイトから正社員","週に何日くらい？（アルバイト希望の方）":"4","1日何時間くらい？（アルバイト希望の方）":"6H以上","何時から何時くらい？":"相談可","聞きたいこと・不安なこと":"異業種からの転職を考えています。男性スタッフの割合を知りたいです。"}];
        
        let newsData = [{"お知らせ":"【合同就職説明会】千葉県かいごの仕事フェア","内容":"県内50法人が集まる合同説明会を開催します。未経験者歓迎コーナーもあります。","開催時期":"2024-03-15","HPリンク":"https://example.com/event1"},{"お知らせ":"【セミナー】はじめての介護職入門","内容":"介護の仕事の魅力や具体的な業務内容をわかりやすく解説するセミナーです。","開催時期":"2024-03-20","HPリンク":"https://example.com/event2"},{"お知らせ":"【見学キャンペーン】春の職場見学ウィーク","内容":"期間中に見学申込をされた方に、特製ノベルティをプレゼント！","開催時期":"2024-04-01","HPリンク":"https://example.com/campaign"},{"お知らせ":"システムメンテナンスのお知らせ","内容":"4月10日（水）AM2:00～AM5:00の間、システムメンテナンスのためサイトが閲覧できません。","開催時期":"2024-04-10","HPリンク":"なし"}];

        // 初期化
        document.addEventListener('DOMContentLoaded', () => {
            render();
        });

        // 表示ロジック
        function render() {
            const main = document.getElementById('main-content');
            main.innerHTML = '';
            
            setTimeout(() => lucide.createIcons(), 0);
            updateAuthButton();

            if (currentView === 'home') {
                renderHome(main);
            } else if (currentView === 'facilityList') {
                renderFacilityList(main);
            } else if (currentView === 'seekers') {
                renderSeekers(main);
            }
        }

        function renderHome(container) {
            // ヒーローセクション（オレンジ枠）
            const heroSection = document.createElement('section');
            heroSection.className = 'fade-in bg-gradient-to-br from-orange-50 to-orange-100 rounded-2xl p-5 mb-4 relative overflow-hidden border-2 border-orange-200';
            heroSection.style.backgroundImage = "linear-gradient(rgba(255, 247, 237, 0.88), rgba(254, 215, 170, 0.88)), url('https://user0514.cdnw.net/shared/img/thumb/roujinIMGL8123_TP_V.jpg')";
            heroSection.style.backgroundSize = 'cover';
            heroSection.style.backgroundPosition = 'right top';
            heroSection.innerHTML = `
                <div class="relative z-10">
                    <h2 class="text-2xl font-bold text-slate-800 mb-2">「まずは見学」から<br/>はじめませんか？</h2>
                    <p class="text-sm text-slate-600 mb-3">いきなり応募はハードルが高い…<br/>そんなあなたのための気軽な見学サイトです。</p>
                    <a href="#" onclick="alert('準備中です。近日公開予定！'); return false;" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-colors w-full flex items-center justify-center gap-2 mb-3">
                        <i data-lucide="coffee" class="w-5 h-5"></i> 見学の流れを見る
                    </a>
                    
                    <!-- 見学した人の声・見学先事業所の声 -->
                    <div class="grid grid-cols-2 gap-2">
                        <a href="#" onclick="alert('準備中です。近日公開予定！'); return false;" class="bg-white hover:bg-orange-50 border border-orange-200 rounded-lg p-3 text-center transition-colors">
                            <i data-lucide="message-circle" class="w-5 h-5 mx-auto mb-1 text-orange-500"></i>
                            <p class="text-xs font-bold text-slate-700">見学した人の声</p>
                        </a>
                        <a href="#" onclick="alert('準備中です。近日公開予定！'); return false;" class="bg-white hover:bg-orange-50 border border-orange-200 rounded-lg p-3 text-center transition-colors">
                            <i data-lucide="building" class="w-5 h-5 mx-auto mb-1 text-orange-500"></i>
                            <p class="text-xs font-bold text-slate-700">見学先事業所の声</p>
                        </a>
                    </div>
                </div>
            `;
            container.appendChild(heroSection);

            // 登録フォームボタン（白色、オレンジアイコン）
            const registrationSection = document.createElement('section');
            registrationSection.className = 'fade-in mb-2';
            registrationSection.innerHTML = `
                <div class="grid grid-cols-2 gap-3">
                    <a href="https://docs.google.com/forms/d/e/1FAIpQLSdV-R8QIhW8V44nbvqP6lJyvnXW-5bfWPg5k5vZNtXuOGb9Iw/viewform" target="_blank" class="bg-white hover:bg-orange-50 text-slate-700 p-4 rounded-xl transition-all shadow-sm hover:shadow-md border border-slate-200 flex items-center gap-2">
                        <i data-lucide="building-2" class="w-6 h-6 text-orange-500 shrink-0"></i>
                        <p class="text-sm font-bold">事業所の方はこちら</p>
                    </a>
                    <a href="https://docs.google.com/forms/d/e/1FAIpQLSfiiBMhnuQpY6-Mag9PZo7wJoMm604Y_9r4IKCPuRGCwjMPVg/viewform" target="_blank" class="bg-white hover:bg-orange-50 text-slate-700 p-4 rounded-xl transition-all shadow-sm hover:shadow-md border border-slate-200 flex items-center gap-2">
                        <i data-lucide="user-check" class="w-6 h-6 text-orange-500 shrink-0"></i>
                        <p class="text-sm font-bold">見学希望の方はこちら</p>
                    </a>
                </div>
            `;
            container.appendChild(registrationSection);

            // 千葉県福祉人材センターへのリンク
            const linkSection = document.createElement('section');
            linkSection.className = 'fade-in mb-2';
            linkSection.innerHTML = `
                <a href="https://www.chibakenshakyo.net" target="_blank" class="bg-white border border-slate-200 rounded-lg p-4 flex items-start gap-3 hover:bg-slate-50 transition-colors">
                    <i data-lucide="globe" class="text-blue-500 w-5 h-5 shrink-0 mt-0.5"></i>
                    <div class="flex-1">
                        <p class="font-bold text-slate-700 mb-1">「千葉県福祉人材センター」でも見つかる。</p>
                        <p class="text-xs text-slate-500">千葉県社会福祉協議会 公式サイトへ</p>
                    </div>
                    <i data-lucide="external-link" class="text-slate-400 w-4 h-4"></i>
                </a>
            `;
            container.appendChild(linkSection);

            // お知らせセクション
            const newsSection = document.createElement('section');
            newsSection.className = 'fade-in mb-4';
            newsSection.innerHTML = `
                <div class="flex items-center gap-2 mb-3">
                    <i data-lucide="bell" class="text-slate-400 w-4 h-4"></i>
                    <h3 class="font-bold text-slate-700">お知らせ</h3>
                </div>
                <div class="bg-white rounded-lg border border-slate-200 p-4">
                    <div class="overflow-y-auto news-scroll pr-2" style="max-height: 200px; scrollbar-width: thin; scrollbar-color: #cbd5e1 #f1f5f9;">
                        ${newsData.map((item, index) => `
                            <div class="py-2 ${index !== newsData.length - 1 ? 'border-b border-slate-100' : ''}">
                                <div class="flex items-center justify-between mb-1">
                                    <p class="text-xs text-slate-400">${item['開催時期']}</p>
                                    ${item['HPリンク'] && item['HPリンク'] !== 'なし' ? `
                                        <a href="${item['HPリンク']}" target="_blank" class="text-xs text-orange-500 hover:underline whitespace-nowrap">詳しく見る →</a>
                                    ` : ''}
                                </div>
                                <p class="font-bold text-slate-700 text-sm">${item['お知らせ']}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            container.appendChild(newsSection);

            // エリア選択セクション
            const areaSection = document.createElement('section');
            areaSection.id = 'area-section';
            areaSection.className = 'fade-in';
            areaSection.innerHTML = `
                <div class="flex items-center gap-2 mb-3">
                    <i data-lucide="map" class="text-slate-400 w-4 h-4"></i>
                    <h3 class="font-bold text-slate-700">エリアから探す</h3>
                </div>
                <div class="grid grid-cols-1 gap-3">
                    ${areas.map(area => `
                        <button onclick="handleAreaSelect('${area.id}')" class="bg-white hover:bg-slate-50 rounded-lg border border-slate-200 p-4 text-left transition-colors shadow-sm">
                            <p class="font-bold text-slate-800 mb-1">${area.name}</p>
                            <p class="text-xs text-slate-400 mb-2">${area.cities || ''}</p>
                            <p class="text-xs text-slate-500">施設: ${facilitiesData.filter(f => f['エリア'] === area.code).length}件</p>
                        </button>
                    `).join('')}
                </div>
            `;
            container.appendChild(areaSection);

            setTimeout(() => lucide.createIcons(), 0);
        }

        function renderFacilityList(container) {
            const selectedArea = areas.find(a => a.id === selectedAreaId);
            const facilities = facilitiesData.filter(f => f['エリア'] === selectedArea.code);

            const header = document.createElement('div');
            header.className = 'mb-4 fade-in';
            header.innerHTML = `
                <button onclick="showHome()" class="flex items-center gap-1 text-sm text-slate-500 hover:text-orange-500 mb-3">
                    <i data-lucide="chevron-left" class="w-4 h-4"></i> エリア選択に戻る
                </button>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <i data-lucide="building" class="text-slate-400 w-4 h-4"></i>
                        <h3 class="font-bold text-slate-700">${selectedArea.name}</h3>
                    </div>
                    <span class="text-xs bg-slate-200 px-2 py-1 rounded-full text-slate-600">${facilities.length}件</span>
                </div>
            `;
            container.appendChild(header);

            const list = document.createElement('div');
            list.className = 'space-y-4';

            if (facilities.length === 0) {
                list.innerHTML = '<p class="text-center text-slate-500 py-8">該当する施設がありません</p>';
            } else {
                facilities.forEach(facility => {
                    const isExpanded = expandedFacilityIds.has(facility['ID']);
                    const card = document.createElement('div');
                    card.className = 'bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden fade-in';
                    
                    const tags = [];
                    if (facility['歓迎チェック （複数回答可）']) {
                        facility['歓迎チェック （複数回答可）'].split(',').forEach(t => {
                            const tag = t.trim();
                            if (tag) tags.push(tag);
                        });
                    }

                    card.innerHTML = `
                        <div class="p-5">
                            <div class="mb-3">
                                <h4 class="font-bold text-slate-800 text-lg mb-2">${facility['事業所の名称'] || ''}</h4>
                                ${tags.length > 0 ? `
                                    <div class="flex flex-wrap gap-1.5 mb-2">
                                        ${tags.map(tag => `<span class="text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full">${tag}</span>`).join('')}
                                    </div>
                                ` : ''}
                                <p class="text-sm text-slate-600 flex items-center gap-1 mb-2">
                                    <i data-lucide="map-pin" class="w-3.5 h-3.5"></i> ${facility['地図で見る'] || ''}
                                </p>
                                ${facility['事業所からの一言'] ? `
                                    <p class="text-sm text-slate-700 bg-slate-50 p-3 rounded-lg border border-slate-100">${facility['事業所からの一言']}</p>
                                ` : ''}
                            </div>

                            <div class="bg-slate-50 p-3 rounded-lg mb-3 mt-3">
                                <div class="flex items-center gap-2 mb-2">
                                    <i data-lucide="user" class="text-slate-400 w-4 h-4"></i>
                                    <p class="text-sm font-bold text-slate-700">担当: ${facility['担当者名'] || ''}</p>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="showAndCallPhone('${facility['電話番号']}', '${facility['事業所の名称']}')" class="flex-1 bg-orange-500 hover:bg-orange-600 text-white text-sm font-bold py-2.5 rounded-lg text-center flex items-center justify-center gap-1.5 shadow transition-colors">
                                        <i data-lucide="phone" class="w-4 h-4"></i> 電話で申込
                                    </button>
                                    <a href="https://docs.google.com/forms/d/e/1FAIpQLScU7Nh4J20qB_Xs00XIkpyGyS3hjbDVdcugPVDckqcLyXri8A/viewform?entry.308812531=${facility['ID']}&entry.1322249521=${encodeURIComponent(facility['事業所の名称'])}" target="_blank" class="flex-1 bg-white hover:bg-slate-50 text-slate-700 text-sm font-bold py-2.5 rounded-lg border border-slate-200 text-center flex items-center justify-center gap-1.5 shadow-sm transition-colors">
                                        <i data-lucide="mail" class="w-4 h-4"></i> メールで申込
                                    </a>
                                </div>
                            </div>

                            <button onclick="toggleDetails('${facility['ID']}')" class="w-full flex items-center justify-center gap-1 text-sm font-bold py-2.5 rounded-lg border transition-colors ${isExpanded ? 'bg-slate-100 text-slate-600 border-slate-200' : 'bg-white text-slate-500 border-slate-200 hover:bg-slate-50'}">
                                ${isExpanded ? '閉じる' : '募集内容を見る'}
                                <i data-lucide="${isExpanded ? 'chevron-up' : 'chevron-down'}" class="w-4 h-4"></i>
                            </button>
                        </div>
                        ${isExpanded ? `
                        <div class="bg-slate-50 border-t border-slate-100 p-4 text-sm fade-in">
                            <h5 class="font-bold text-slate-700 mb-3 flex items-center gap-2"><i data-lucide="eye" class="text-orange-500 w-4 h-4"></i> 見学受入</h5>
                            <div class="mb-5">
                                ${renderBulletList('対象者', facility['見学を受入できる対象者（複数回答可）'])}
                            </div>
                            
                            <h5 class="font-bold text-slate-700 mb-3 flex items-center gap-2"><i data-lucide="briefcase" class="text-orange-500 w-4 h-4"></i> 募集内容</h5>
                            <div class="space-y-3 mb-5">
                                ${renderDetailRow('種別', facility['種別 （複数回答可）'])}
                                ${renderDetailRow('資格', facility['歓迎チェック （複数回答可）'])}
                                ${renderDetailRow('経験', facility['介護の仕事経験'])}
                                ${renderDetailRow('中高年', facility['中高年世代の採用'])}
                                <div class="h-px bg-slate-200 my-2"></div>
                                ${renderDetailRow('雇用形態', facility['雇用形態'])}
                                ${renderDetailRow('日数', facility['募集の日数（週） （複数回答可）'])}
                                ${renderDetailRow('時間数', facility['募集の時間数（日） （複数回答可）'])}
                                ${renderDetailRow('勤務時間', facility['募集の時間（〇時～〇時）'])}
                            </div>
                            <h5 class="font-bold text-slate-700 mb-3 flex items-center gap-2"><i data-lucide="map" class="text-orange-500 w-4 h-4"></i> マップ</h5>
                            <div class="flex gap-2">
                                ${facility['地図で見る'] ? `
                                    <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(facility['地図で見る'])}" target="_blank" class="flex-1 bg-white hover:bg-slate-100 text-slate-700 py-3 rounded-lg border border-slate-200 text-center text-xs font-bold flex items-center justify-center gap-2 shadow-sm">
                                        <i data-lucide="map-pin" class="text-red-500 w-4 h-4"></i> Googleマップ
                                    </a>
                                ` : ''}
                                ${facility['HP'] && facility['HP'] !== 'なし' ? `
                                    <a href="${facility['HP']}" target="_blank" class="flex-1 bg-white hover:bg-slate-100 text-slate-700 py-3 rounded-lg border border-slate-200 text-center text-xs font-bold flex items-center justify-center gap-2 shadow-sm">
                                        <i data-lucide="globe" class="text-blue-500 w-4 h-4"></i> ホームページ
                                    </a>
                                ` : ''}
                            </div>
                        </div>` : ''}
                    `;
                    list.appendChild(card);
                });
            }
            container.appendChild(list);
            setTimeout(() => lucide.createIcons(), 0);
        }

        function renderSeekers(container) {
            container.innerHTML = `
                <div class="bg-slate-100 border border-slate-200 rounded-xl p-4 flex items-start gap-3 mb-6 fade-in">
                    <i data-lucide="lock" class="text-slate-500 shrink-0 w-4 h-4 mt-0.5"></i>
                    <div>
                        <p class="text-sm font-bold text-slate-700">閲覧モード: 事業所専用</p>
                        <p class="text-xs text-slate-500 mt-1">※ここは一般公開されていません。</p>
                    </div>
                </div>
                <section class="fade-in">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-2">
                            <i data-lucide="user" class="text-slate-400 w-4 h-4"></i>
                            <h3 class="font-bold text-slate-700">見学希望者リスト</h3>
                        </div>
                        <span class="text-xs bg-slate-200 px-2 py-1 rounded-full text-slate-600">${seekersData.length}名</span>
                    </div>
                    <div class="space-y-4">
                        ${seekersData.map(seeker => `
                            <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-5 relative overflow-hidden">
                                <div class="absolute top-0 left-0 w-1.5 h-full bg-slate-400"></div>
                                <div class="flex justify-between items-start mb-3 pl-2">
                                    <div class="flex items-center gap-2">
                                        <span class="bg-slate-800 text-white text-xs font-mono px-2 py-1 rounded">ID: ${seeker['ID']}</span>
                                        <span class="font-bold text-slate-700">${seeker['年齢']} / ${seeker['性別']}</span>
                                    </div>
                                    <span class="text-xs font-bold text-slate-600 bg-orange-50 px-2 py-1 rounded-md border border-orange-200">働くとしたら：${seeker['もし働くなら、どんな働き方？']}</span>
                                </div>
                                <div class="pl-2 space-y-3">
                                    <div class="flex items-center gap-2 text-sm text-slate-600">
                                        <i data-lucide="check-circle" class="text-slate-400 w-4 h-4"></i>
                                        <span class="font-bold">${seeker['資格']}</span>
                                        <span class="text-slate-400">|</span>
                                        <span>${seeker['お住まい']}</span>
                                    </div>
                                    <div class="text-xs text-slate-500 space-y-1">
                                        <p><strong>仕事への興味:</strong> ${seeker['仕事への興味']}</p>
                                        ${seeker['週に何日くらい？（アルバイト希望の方）'] ? `<p><strong>週の日数:</strong> ${seeker['週に何日くらい？（アルバイト希望の方）']}</p>` : ''}
                                        ${seeker['1日何時間くらい？（アルバイト希望の方）'] ? `<p><strong>時間数:</strong> ${seeker['1日何時間くらい？（アルバイト希望の方）']}</p>` : ''}
                                        ${seeker['何時から何時くらい？'] ? `<p><strong>希望時間:</strong> ${seeker['何時から何時くらい？']}</p>` : ''}
                                    </div>
                                    <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 text-sm text-slate-600 leading-relaxed">${seeker['聞きたいこと・不安なこと'] || '特になし'}</div>
                                    <div class="mt-3">
                                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSdtx3pwHHeVGRPZhuwWke8bRkaSM4dEvyDi48cKAiT4eMPWlA/viewform?entry.1369073720=${seeker['ID']}" target="_blank" class="w-full bg-white border-2 border-slate-400 text-slate-600 hover:bg-slate-50 font-bold py-2.5 rounded-lg transition-colors flex items-center justify-center gap-2">
                                            <i data-lucide="mail" class="w-4 h-4"></i> 見学にお誘いする
                                        </a>
                                        <p class="text-xs text-slate-400 text-center mt-2">※対象者から返信がない場合もあります。ご了承ください。</p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </section>
            `;
            
            setTimeout(() => lucide.createIcons(), 0);
        }

        // ヘルパー関数
        function renderDetailRow(label, value) {
            return `
                <div class="flex items-start text-sm">
                    <span class="w-24 shrink-0 text-slate-400 font-bold text-xs pt-0.5">${label}</span>
                    <span class="text-slate-700 font-medium">${value || '-'}</span>
                </div>`;
        }

        function renderBulletList(label, value) {
            if (!value) return `
                <div class="flex items-start text-sm">
                    <span class="w-24 shrink-0 text-slate-400 font-bold text-xs pt-0.5">${label}</span>
                    <span class="text-slate-700 font-medium">-</span>
                </div>`;
            
            const items = value.split(',').map(item => item.trim()).filter(item => item);
            return `
                <div class="flex items-start text-sm">
                    <span class="w-24 shrink-0 text-slate-400 font-bold text-xs pt-0.5">${label}</span>
                    <div class="text-slate-700 font-medium space-y-1">
                        ${items.map(item => `<div class="flex items-start gap-2"><span class="text-orange-500">•</span><span>${item}</span></div>`).join('')}
                    </div>
                </div>`;
        }

        function updateAuthButton() {
            const authBtnArea = document.getElementById('auth-btn-area');
            if (isAuthenticated) {
                authBtnArea.innerHTML = `
                    <button onclick="handleLogout()" class="text-orange-500 hover:text-orange-600 p-2">
                        <i data-lucide="log-out" class="w-5 h-5"></i>
                    </button>
                `;
            } else {
                authBtnArea.innerHTML = `
                    <button onclick="openAuthModal()" class="text-slate-300 hover:text-orange-500 p-2">
                        <i data-lucide="lock" class="w-5 h-5"></i>
                    </button>
                `;
            }
            setTimeout(() => lucide.createIcons(), 0);
        }

        // アクション関数
        function showHome() {
            currentView = 'home';
            render();
        }

        function handleAreaSelect(id) {
            selectedAreaId = id;
            currentView = 'facilityList';
            window.scrollTo(0, 0);
            render();
        }

        function toggleDetails(id) {
            if (expandedFacilityIds.has(id)) {
                expandedFacilityIds.delete(id);
            } else {
                expandedFacilityIds.add(id);
            }
            render();
        }

        function openAuthModal() {
            document.getElementById('auth-modal').classList.remove('hidden');
            document.getElementById('password-input').focus();
        }

        function closeAuthModal() {
            document.getElementById('auth-modal').classList.add('hidden');
        }

        function handleAuth() {
            const input = document.getElementById('password-input');
            if (input.value === PASSWORD) {
                isAuthenticated = true;
                currentView = 'seekers';
                closeAuthModal();
                input.value = '';
                render();
            } else {
                alert('パスワードが違います');
                input.value = '';
                input.focus();
            }
        }

        function handleLogout() {
            isAuthenticated = false;
            currentView = 'home';
            render();
        }

        // 電話番号表示・発信機能
        function showAndCallPhone(phone, facilityName) {
            if (!phone) {
                alert('電話番号が登録されていません');
                return;
            }
            
            // 確認ダイアログで電話番号を表示
            const makeCall = confirm(`${facilityName || '事業所'}\n\n電話番号: ${phone}\n\n発信しますか？`);
            
            if (makeCall) {
                window.location.href = `tel:${phone}`;
            }
        }

        // Enterキーでパスワード認証
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !document.getElementById('auth-modal').classList.contains('hidden')) {
                handleAuth();
            }
        });
    </script>
</body>
</html>
